<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Color Diff Stats</title>
        <style>
            body{
                font-family:sans-serif;
            }
            #c{
                width: 512px;
                height: 512px;
            }


        </style>
      
</head>
<body>
<canvas id="c" width="512px" height="512px"></canvas>
<ul id="db"></ul>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script>        

                var dirs = ['a','b','c','d']
                var $db = $('#db');
                var colors = [];
                //var jsonDummy= {"0": {"direction": {"a": [], "c": [6, 8, 6, 10, 9, 7, 10, 18, 3, 4, 3, 12, 8, 3, 5, 4, 21, 23, 5, 20, 10, 10, 7], "b": [16, 13, 11, 13, 25, 19, 15, 26, 13, 11, 32, 11, 22, 22, 11, 16, 10, 4, 11, 14, 8, 4, 4, 20, 10, 10, 17, 11, 2, 14], "d": []}}, "1": {"direction": {"a": [], "c": [14, 9, 20, 17, 8, 13, 2, 16, 5, 5, 4, 11, 5, 12, 6, 8, 8, 2], "b": [10, 9, 16, 4, 6, 9, 7, 11, 11, 8, 7], "d": [21, 10, 11, 7, 8, 5, 14, 4, 12, 13, 8, 10, 12, 9]}}, "2": {"direction": {"a": [], "c": [6, 3, 9, 11, 6, 6, 4, 8, 19, 18, 19, 22, 8], "b": [5, 4, 7, 4, 4, 7, 6, -1, 7, 7, 4, 7], "d": [5, 45, 5, 5, 8, 7, 9, 15]}}, "3": {"direction": {"a": [], "c": [16, 26, 9, 11, 21, 12, 4, 8, 6, 11, 11, 21, 15, 10, 6, 14], "b": [-140, 6, 5, 14, 4, 34, 3, 3, 7, 1, 9, 6, 8], "d": [8, -42, 2, 4, 8, 5, 2, 9, 7, 3, 6, 6, 6, 8, 10, 4, 7, 12, 14, 3]}}, "4": {"direction": {"a": [], "c": [29, 16, 11, 16, 7, 6, 7, 7, 6, 8, 6, 5, 16, 19, 12, 15, 7, 19, 18], "b": [], "d": [17, 3, 8, 5, 6, 1, 9, 43, 7, 7, 8, 4, 9, 19, 26, 13, 12, 14]}}, "5": {"direction": {"a": [8, 8, 8, 6, 9, 8, 5, 9, 7, 8, 10, 12, 11, 3, 11], "c": [4, 5, 6, -3, 9, 7, 7, 2, 7, 12, 5, 8, 11, 2, 12, 6, 7, 5], "b": [16, 13, 14, 3, 42, 8, 7, 7, 13, 10, 21, 13, 11], "d": []}}, "6": {"direction": {"a": [3, 7, 4, 9, 1, 8, 2, 5, 1, 11], "c": [4, 2, 12, 4, 4, 4, 0, 16, 3], "b": [37, 19, 5, 5, 5, 14, 11, 7], "d": [4, 5, 36, 1, 7, 12, 11, 7, 6]}}, "7": {"direction": {"a": [4, 4, 6, 4, 9, 9, 9, 7, 26, 8, 5], "c": [5, 3, 10, 10], "b": [0, 7, 9, 12, 10, 9, 6, 7], "d": [4, 3, 4, 2, 5, 4, 8, 10, 4, 5]}}, "8": {"direction": {"a": [12, 6, 7, 10, 3, 12, 8, 1, 6, 11, 7, 13], "c": [8, 5, 13, 1, 4, 2], "b": [4, 4, 0, 9, 6, 5, 5, 5, 4, 8, 3], "d": [7, 6, 6, 8, 5, 8]}}, "9": {"direction": {"a": [35, 14, 8, 8, 7, 8, 11, 10, 8], "c": [7, 6, 8, 4, 4, 13, 2, 5, 7, 3, 9, 10, 6], "b": [], "d": [4, 14, 13, 4, 50, 7, 9, 14, 6, 10, 9, 6, 16, 5, 15]}}, "10": {"direction": {"a": [5, 3, 4, 94, 11, 8, 5, 7, 6, 3, 4, 9, 1, 6, 5, 7, 11, 8, 15], "c": [6, 6, 6, 5, 5, 7, 6, 12, 13, 8, 3, 6, 15, 4], "b": [26, 13, 14, 8, 11, 31, 20, 13, 18], "d": []}}, "11": {"direction": {"a": [4, 4, 10, 10, 9, 44, 4, 9, 12, 8, 6], "c": [6, 0, 8, 10, 1, 10, 7, 5, 7], "b": [7, 8, 14, 16, 7, 3, 16, 15, 10], "d": [9, 10, 12, 17, 6, 9, 8, 11, 7, 13, 9, 12, 4, 11]}}, "12": {"direction": {"a": [5, 8, 7, 2, 9, 18, 11, 5], "c": [12, 6, 2, 7, 12, 42, 3, 8, 11, 12, 6, 5, 5], "b": [3, 6, 6, 11, 2, 4, 3, 8], "d": [3, 14, 10, 1, 7, 5]}}, "13": {"direction": {"a": [10, 18, 3, 7, 6, 5, 5, 11, 11, 3, 12], "c": [12, 13, 6, 5, 11, 7, 4, 3, 2, 4, 5, 13, 13, 1, 4, 5, 13, 8], "b": [6, 10, 7, 7, 10, 5, 6, 5, 8, 10, 9, 3, 5, 11], "d": [6, 26, 2, 43, 6, 15]}}, "14": {"direction": {"a": [5, 7, 6, 7, 4, 9, 5, 14, 5, 10, 8], "c": [7, 12, 7, 2, 32, 13, 7, 7, 7, 6], "b": [], "d": [5, 6, 4, 4, 7, 11, 5, 14, 7]}}, "15": {"direction": {"a": [16, 9, 6, 21, 9, 6, 4, 5, 9, 11], "c": [6, 11, 23, 3, 5, 8, 2, 4, 4, 4, 6, 5, 4, 3], "b": [22, 15, 29, 24, 19, 23, 6, 9, 8, 18, 8, 10, 4, 13, 4, 11, 7, 8, 14, 8, 10, 27, 6], "d": []}}, "16": {"direction": {"a": [4, 12, 8, 7, 1, 7], "c": [5, 9, 7, 3, 4, 4, 10, 1, 13], "b": [17, 11, 4, 11, 9, 5, 11, 5, 11, 1, 8, 13, 7], "d": [14, 5, 7, 43, 11, 15, 16, 7, 3, 10, 7]}}, "17": {"direction": {"a": [4, 2, 6, 11, 7, 7, 6, 4, 7, 7, 6], "c": [12, 5, 7, 6, 8, 5, 11, 7, 7, 11, 10, 11], "b": [5, 6, 4, 6, 10, 1, 10, 11, 5, 11], "d": [6, 20, 6, 1, 8, 4, 7, 8, 2, 6, 8]}}, "18": {"direction": {"a": [4, 10, 8, 9, 10, 9, 6, 5, 5, 4, 11, 8, 6, 6], "c": [11, 7, 6, 6, 7, 10, 8, 5], "b": [6, 5, 6, 5, 9, 7, 1, 9, 5], "d": [11, 15, -48, 6, 3, 10, 8, 8, 6, 8, 3]}}, "19": {"direction": {"a": [8, 4, 12, 14, 7, 8, 8, 6, 9, 6, 11], "c": [28, 7, 4, 5, 14, 11, 9, 3, 8, 42, 11, 4, 6, 8, 11, 5, 5], "b": [], "d": [11, -9, 3, 25, 15, 6, 5, 7, 5, 8, 7, 9, 6, 8, 10, 3]}}, "20": {"direction": {"a": [19, 15, 10, 9, 50, 8, 6, 7, 8, 11, 7, 14, 11, 10, 4, 12, 8, 15, 22, 12, 13, 19, 7, 29], "c": [], "b": [37, 13, 11, 10, 42, 8, 31, 21, 5, 6, 7, 9, 23, 21, 16], "d": []}}, "21": {"direction": {"a": [6, 9, 1, 48, 9, 8, 4], "c": [], "b": [7, 5, 7, 7, 12, 51, 7, 1, 15, 12, 10, 6, 12, 12], "d": [9, 14, 45, 21, 12, 8, 12, 4, 6, 2, 8, 17]}}, "22": {"direction": {"a": [11, 9, 3, 6, 8, 12, 5, 12, 1, 8, 6, 9, 7], "c": [], "b": [11, 4, 4, 10, 7, 14, 5, 4, 10], "d": [8, 7, 5, 30, 6, 8, 4, 10]}}, "23": {"direction": {"a": [27, 4, 9, 42, 6, 2, 5, 8, 9, 4, 4, 9, 9], "c": [], "b": [12, 3, 8, 6, 13, 5, 1, 11, 2, 7, 1, 6, 7, 9, 8, 7], "d": [10, 11, 9, 7, 5, 6, 5, 5, 5, 5, 5, 6, 12]}}, "24": {"direction": {"a": [21, 10, 6, 11, 12, 8, 12, 11, 6, 8, 7, 12, 11, 9, 4, 12, 6, 6, 9, 5, 9, 6, 0, 7, 12, 14, 11, 5], "c": [], "b": [], "d": [2, 11, 5, 5, 12, 10, 5, 4, 5, 2, 4, 8, 12, 4, 13, 13, 10, 8, 7, 9, 3]}}}
                var ctx = $('#c')[0].getContext('2d');

                var Color = function (r, g, b) {
                    this.r = r;
                    this.g = g;
                    this.b = b;
                }
                function fillColors() {
                    var s = 1 / 5 * 255; //step
                    var m = 1 / 10 * 255; //margin
                    for (var y = 0; y < 5; y++) {
                        for (var x = 0; x < 5; x++) {
                            colors.push(new Color(~~(x * s + m), 128, ~~(y * s + m)));
                        }
                    }
                }


                function drawColors(){
                    var pic = ctx.getImageData(0,0, ctx.canvas.width, ctx.canvas.height), pix = pic.data,pos;
                    for (var x = 0; x < 512; x++){
                        for (var y=0;y<512;y++){
                            pos=(y*512+x)*4;
                            pix[pos]=x>>1;
                            pix[pos+1]=128;
                            pix[pos+2]=y>>1;
                            pix[pos+3]=255;
                        }
                    }
                    ctx.putImageData(pic,0,0);
                }


                function drawBoundary(data){
                       function average(values){
                           var sum =0;
                           if (values.length ==0)return 0;
                           for (var i = 0;i<values.length;i++){
                               sum+=values[i];
                           }
                            return sum/values.length;
                       }

                        function median(values){
                            values.sort(function(a,b){return a-b});
                            var mid = values.length/2;
                            return (values[~~mid]+values[~~(mid+.5)])/2||0
                        }

                    ctx.strokeStyle="rgba(255,255,255,1)";
                    ctx.lineWidth=.5;
                   for (var i = 0; i<25;i++){
                   var x = colors[i].r*2,
                       y = colors[i].b*2,
                       color=data[i],
                       a = median(color.direction.a)*2,
                       b = median(color.direction.b)*2,
                       c = median(color.direction.c)*2,
                       d = median(color.direction.d)*2;
                       ctx.beginPath();
                       ctx.moveTo(x,y-a);
                       ctx.quadraticCurveTo(x+b,y-a,x+b,y);
                       ctx.quadraticCurveTo(x+b,y+c,x,y+c);
                       ctx.quadraticCurveTo(x-d,y+c,x-d,y);
                       ctx.quadraticCurveTo(x-d,y-a,x,y-a);
                       ctx.stroke();
                   }
                }
                fillColors();
                drawColors();

	        var url = 'http://cdiff.moritzklack.com/py/measurement.py';
	        $.ajax({
	        	url: url,
	        	type: 'POST',
	        	data : {
	        		action : 'getall'
	        	},
	        	success: function(data) {
                    drawBoundary(data);

                    for (var i = 0; i < 25; i++){
               
                                   var li = '<li id=\"color_' + i + '\">ID: ' + i + '<ul>';
                                   for (var d =0; d < 4; d++){
                                       var dir = dirs[d];
                                       
                                       li += '<li id=\"color_' + i + '_dir_' + dir + '\">' + dir + ': ' + data[i].direction[dir] + '</li>';   
                                   }
                                   li += '</ul></li>';
	        		   $db.append(li);	
	        		}
	        	}
	        });
  // drawBoundary(jsonDummy);
</script>

</body>
</html>
