<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Color Diff Stats</title>
        <style>
            body{
                font-family:sans-serif;
            }
            #c{
                width: 512px;
                height: 512px;
            }


        </style>
      
</head>
<body>
<canvas id="c" width="256px" height="256px"></canvas>
<ul id="db"></ul>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script>        

                var dirs = ['a','b','c','d']
                var $db = $('#db');
                var colors = [];
             //   var jsonDummy={"0": {"direction": {"a": [], "c": [6, 8, 6, 10, 9, 7, 10, 18], "b": [16, 13, 11, 13, 25, 19, 15, 26, 13, 11, 32, 11, 22, 22, 11, 16], "d": []}}, "1": {"direction": {"a": [], "c": [14, 9, 20, 17, 8, 13, 2, 16], "b": [10, 9, 16, 4], "d": [21, 10, 11, 7, 8, 5, 14]}}, "2": {"direction": {"a": [], "c": [6], "b": [5, 4, 7, 4], "d": [5, 45]}}, "3": {"direction": {"a": [], "c": [16, 26, 9, 11, 21], "b": [-140, 6, 5, 14, 4, 34, 3], "d": [8, -42, 2, 4, 8, 5, 2]}}, "4": {"direction": {"a": [], "c": [29, 16, 11, 16, 7], "b": [], "d": [17, 3, 8, 5, 6, 1, 9, 43, 7, 7, 8]}}, "5": {"direction": {"a": [8, 8, 8, 6, 9, 8], "c": [4, 5, 6, -3, 9, 7, 7, 2, 7], "b": [16, 13, 14, 3, 42], "d": []}}, "6": {"direction": {"a": [3, 7, 4, 9], "c": [4, 2, 12, 4, 4, 4, 0], "b": [37, 19, 5], "d": [4, 5, 36]}}, "7": {"direction": {"a": [4, 4, 6, 4, 9], "c": [5, 3, 10], "b": [0, 7, 9, 12], "d": [4, 3, 4, 2, 5]}}, "8": {"direction": {"a": [12, 6, 7, 10, 3, 12], "c": [8, 5], "b": [4, 4, 0, 9], "d": []}}, "9": {"direction": {"a": [35, 14, 8, 8], "c": [7, 6, 8, 4, 4], "b": [], "d": [4, 14, 13, 4, 50, 7, 9, 14, 6, 10]}}, "10": {"direction": {"a": [5, 3, 4, 94, 11, 8, 5, 7, 6, 3], "c": [6, 6, 6, 5, 5], "b": [26, 13, 14, 8], "d": []}}, "11": {"direction": {"a": [4, 4, 10, 10, 9, 44], "c": [6, 0, 8, 10], "b": [7, 8], "d": [9, 10, 12, 17, 6]}}, "12": {"direction": {"a": [5, 8, 7, 2], "c": [12, 6, 2, 7, 12, 42], "b": [3, 6, 6], "d": [3, 14, 10, 1]}}, "13": {"direction": {"a": [10, 18, 3, 7, 6, 5, 5], "c": [12, 13, 6, 5, 11, 7, 4, 3, 2], "b": [6, 10, 7, 7], "d": [6, 26, 2, 43]}}, "14": {"direction": {"a": [5, 7, 6, 7, 4, 9], "c": [7, 12, 7, 2, 32], "b": [], "d": [5, 6, 4]}}, "15": {"direction": {"a": [16, 9, 6, 21, 9, 6, 4], "c": [6, 11, 23], "b": [22, 15, 29, 24, 19, 23, 6, 9, 8, 18], "d": []}}, "16": {"direction": {"a": [4], "c": [5, 9, 7, 3], "b": [17, 11, 4, 11, 9], "d": [14, 5, 7, 43]}}, "17": {"direction": {"a": [4, 2, 6], "c": [12, 5, 7, 6, 8], "b": [5, 6, 4, 6, 10, 1, 10], "d": [6, 20, 6]}}, "18": {"direction": {"a": [4, 10, 8, 9], "c": [11, 7, 6], "b": [6, 5], "d": [11, 15, -48, 6, 3, 10]}}, "19": {"direction": {"a": [8, 4, 12, 14, 7, 8], "c": [28, 7, 4, 5, 14, 11, 9, 3, 8, 42, 11, 4, 6], "b": [], "d": [11, -9, 3]}}, "20": {"direction": {"a": [19, 15, 10, 9], "c": [], "b": [37, 13, 11, 10, 42, 8, 31], "d": []}}, "21": {"direction": {"a": [6, 9, 1], "c": [], "b": [7, 5, 7, 7, 12], "d": [9, 14, 45, 21, 12, 8, 12]}}, "22": {"direction": {"a": [11, 9, 3, 6, 8], "c": [], "b": [11, 4, 4, 10, 7, 14], "d": [8, 7, 5, 30]}}, "23": {"direction": {"a": [27, 4, 9, 42, 6, 2], "c": [], "b": [12, 3, 8, 6, 13, 5, 1], "d": [10, 11, 9, 7, 5, 6, 5]}}, "24": {"direction": {"a": [21, 10, 6, 11, 12, 8, 12, 11, 6, 8, 7, 12, 11], "c": [], "b": [], "d": [2, 11, 5, 5, 12, 10]}}}
                var ctx = $('#c')[0].getContext('2d');

                var Color = function (r, g, b) {
                    this.r = r;
                    this.g = g;
                    this.b = b;
                }
                function fillColors() {
                    var s = 1 / 5 * 255; //step
                    var m = 1 / 10 * 255; //margin
                    for (var y = 0; y < 5; y++) {
                        for (var x = 0; x < 5; x++) {
                            colors.push(new Color(~~(x * s + m), 128, ~~(y * s + m)));
                        }
                    }
                }


                function drawColors(){
                    var pic = ctx.getImageData(0,0, ctx.canvas.width, ctx.canvas.height), pix = pic.data,pos;
                    for (var x = 0; x < 256; x++){
                        for (var y=0;y<256;y++){
                            pos=(y*256+x)*4;
                            pix[pos]=x;
                            pix[pos+1]=128;
                            pix[pos+2]=y;
                            pix[pos+3]=255;
                        }
                    }
                    ctx.putImageData(pic,0,0);
                }


                function drawBoundary(data){
                       function average(values){
                           var sum =0;
                           if (values.length ==0)return 0;
                           for (var i = 0;i<values.length;i++){
                               sum+=values[i];
                           }
                            return sum/values.length;
                       }
                    ctx.strokeStyle="rgba(255,255,255,1)";
                    ctx.lineWidth=.2;
                   for (var i = 0; i<25;i++){
                   var x = colors[i].r,
                       y = colors[i].b,
                       color=data[i],
                       a = average(color.direction.a),
                       b = average(color.direction.b),
                       c = average(color.direction.c),
                       d = average(color.direction.d);
                       ctx.beginPath();
                       ctx.moveTo(x,y-a);
                       ctx.quadraticCurveTo(x+b,y-a,x+b,y);
                       ctx.quadraticCurveTo(x+b,y+c,x,y+c);
                       ctx.quadraticCurveTo(x-d,y+c,x-d,y);
                       ctx.quadraticCurveTo(x-d,y-a,x,y-a);
                       ctx.stroke();
                   }
                }
                fillColors();
                drawColors();

	        var url = 'http://cdiff.moritzklack.com/py/measurement.py';
	        $.ajax({
	        	url: url,
	        	type: 'POST',
	        	data : {
	        		action : 'getall'
	        	},
	        	success: function(data) {
                    drawBoundary(data);

                    for (var i = 0; i < 25; i++){
               
                                   var li = '<li id=\"color_' + i + '\">ID: ' + i + '<ul>';
                                   for (var d =0; d < 4; d++){
                                       var dir = dirs[d];
                                       
                                       li += '<li id=\"color_' + i + '_dir_' + dir + '\">' + dir + ': ' + data[i].direction[dir] + '</li>';   
                                   }
                                   li += '</ul></li>';
	        		   $db.append(li);	
	        		}
	        	}
	        });
//    drawBoundary(jsonDummy);
</script>

</body>
</html>
