<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ColorDiff2</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
</head>
<body>

    <style type="text/css">
        body {
            background-color: black;
        }

        #wrapper {
            width: 600px;
            height: 256px;
            margin: auto;
            margin-top: 50px;
        }

        #color1 {
            float: left;
            height: 256px;
            width: 256px;
            background-color: #00FF00;
        }

        #color2 {
            float: left;
            margin-left: 20px;
            height: 256px;
            width: 256px;
            background-color: #00FF50;
        }




    </style>
    <div id="wrapper">
        <div id="color1">
        </div>
        <div id="color2">
        </div>
    </div>
    <script>
        var colors = new Array();
        var colorID;
        var direction;
        var color1;
        var color2;

        window.onload = function() {
            fillColors();
            init();
        }

        var c1 = document.getElementById('color1');
        var c2 = document.getElementById('color2');
        var offsetL;

        var Color = function(r,g,b) {
            this.r = r;
            this.g = g;
            this.b = b;

            this.getHex = function() {
                return '#' + this.decToStr(this.r) + this.decToStr(this.g) + this.decToStr(this.b);
            }
            this.decToStr = function(c) {
                if(c.toString(16).length == 1) {
                    c = '0' + c.toString(16);
                }
                else {
                    c = c.toString(16);
                }
                return c;
            }
        }

        function fillColors() {
            var i = 0;
            var s = 1/5 * 255; //step
            var m = 1/10 * 255; //margin
            for(var y = 0; y < 5; y++) {
                for(var x = 0; x < 5; x++) {
                    var r = Math.floor(x * s + m);
                    var g = Math.floor(128);
                    var b = Math.floor(y * s + m);
                    var color = new Color(r,g,b);
                    colors[i] = color;
                    i++; 
                }
            }
         }

        function init() {
            offsetL = $(c2).offset().left;
            colorID = Math.floor(Math.random()*25);
            color1 = colors[colorID];
            var values;
            if(colorID == 0) {
               values = [1,2];
            }
            else if(colorID == 20) {
                values = [0,1];
            }
            else if(colorID == 24) {
                values = [3,0];
            }
            else if(colorID == 4) {
                values = [3,2];
            }
            else if(colorID > 0 && colorID < 4) {
                values = [3,2,1];
            }
            else if(colorID%5 == 0 && colorID < 20 && colorID > 0) {
                values = [0,2,1];
            }
            else if(colorID == 9 || colorID == 14 || colorID == 19) {
                values = [2,3,0];
            } 
            else if(colorID > 20 && colorID < 24) {
                values = [0,3,1];
            }
            else {
                values = [0,1,2,3];
            }

            direction = randomize(values);

            switch(direction) {
                case 0:
                    color2 = colors[colorID-5];
                    break;
                case 1:
                    color2 = colors[colorID+1];
                    break;
                case 2:
                    color2 = colors[colorID+5];
                    break;
                case 3:
                    color2 = colors[colorID-1];
                default :
                    break;
            }
            c1.style.backgroundColor = color1.getHex();
            c2.style.backgroundColor = color2.getHex();
            console.log(c1.style.backgroundColor + ' ### ' + c2.style.backgroundColor);

        }

        function randomize(arr) {
            var r = Math.floor(Math.random() * arr.length);
            return arr[r];
        }

        var s = 51/255;
        var nb;
        var nr;
        var diff;

        $('#color2').mousemove(function(e) {
            if(direction == 0) {
                nb = Math.floor(color2.b + ((e.pageX-offsetL)*s));
                c2.style.backgroundColor = '#' + color2.r.toString(16) + color2.g.toString(16) + nb.toString(16);
            }
            else if(direction == 1) {
                nr = Math.floor(color2.r + ((e.pageX-offsetL)*(-s)));
                c2.style.backgroundColor = '#' + nr.toString(16) + color2.g.toString(16) + color2.b.toString(16);
            }
            else if(direction == 2) {
                nb = Math.floor(color2.b + ((e.pageX-offsetL)*(-s)));
                c2.style.backgroundColor = '#' + color2.r.toString(16) + color2.g.toString(16) + nb.toString(16);
            }
            else if(direction == 3) {
                nr = Math.floor(color2.r + ((e.pageX-offsetL)*(s)));
                c2.style.backgroundColor = '#' + nr.toString(16) + color2.g.toString(16) + color2.b.toString(16);
            }
        }).click(function(e) {
            if(direction == 0) {
                diff = color1.b - nb;
            }
            else if(direction == 1) {
                diff = nr - color1.r;
            }
            else if(direction == 2) {
                diff = nb - color1.b;
            }
            else if(direction == 3) {
                diff = color1.r - nr;
            }
            console.log(colorID + '#' + direction + '#' + diff);
            pushData(colorID, direction, diff);
        });

        function pushData(colorID, direction, value){
            var url = 'http://cdiff.moritzklack.com/py/measurement.py';
            var dir = ['a','b','c','d'][direction];
            $.ajax({
                url: url,
                dataType : 'json',
                data: {action:'save',colorID:colorID,direction:dir,value:value},
                success: function(data) {
                    console.log(data);
                    init();
                }
            });
        }
    </script>
</body>
</html>
